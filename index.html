<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tees For A Cause : Design Competition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Scrapbook vibe fonts used by the combined CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600;700&family=Karla:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Combined stylesheet inlined -->
  <style>
/* ===========================
   Tees For A Cause â€” Shared CSS (Standalone)
   Restored scrapbook design + wider form card
   =========================== */

:root{
  /* Colors */
  --bg:#F5EFE6;
  --paper:#FFFFFC;
  --ink:#111111;
  --muted:#5d5d5d;
  --border:#d9d2c6;
  --accent:#111111;
  --accent-contrast:#ffffff;

  /* Fonts */
  --font-heading:"Playfair Display", Georgia, serif;
  --font-body:"Karla", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  --font-accent:"Caveat", system-ui, sans-serif;

  /* Layout tweaks */
  --form-max: 880px;   /* WIDER form card */
  --hero-max: 920px;   /* Thank-you card width */

  /* Optional: tweak logo visual centering */
  --logo-x:50%;
  --logo-y:50%;
}

*,*::before,*::after{ box-sizing:border-box; }
html,body{ height:100%; }

/* Base body (scrollable by default) */
body{
  margin:0;
  min-height:100vh;
  background:
    linear-gradient(var(--bg), var(--bg)),
    url("https://www.transparenttextures.com/patterns/handmade-paper.png");
  color:var(--ink);
  font-family:var(--font-body);
  padding:24px;
  overflow-x:clip;
}

/* Center only the thank-you page vertically */
.page-thanks{
  min-height:100vh;
  min-height:100svh;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Form page: ensure comfy bottom space after preview expands */
.page-index{
  padding-bottom: clamp(96px, 14vh, 200px);
}

/* Headings */
h1{
  margin:0;
  font-family:var(--font-heading);
  font-weight:700;
  font-size:28px;
  line-height:1.25;
  letter-spacing:.2px;
}

/* Logo (circular, contained) */
.logo{
  width:140px;
  height:140px;
  border-radius:50%;
  object-fit:contain;
  object-position:var(--logo-x) var(--logo-y);
  border:3px solid var(--ink);
  background:transparent;
  box-shadow:0 4px 12px rgba(0,0,0,.18);
  display:block;
}

/* Paper card/wrap */
.card{
  position:relative;
  width:100%;
  max-width:var(--form-max);
  background:
    linear-gradient(var(--paper), var(--paper)),
    url("https://www.transparenttextures.com/patterns/paper-1.png");
  border:1px solid var(--border);
  border-radius:14px;
  padding:26px 22px 22px;
  box-shadow:0 10px 24px rgba(0,0,0,0.15), 0 2px 0 rgba(0,0,0,0.04);
  overflow:hidden;
  margin-inline:auto;
}

/* Decorative tape on form card */
.card::before{
  content:"";
  position:absolute;
  top:10px; left:16px;
  width:68px; height:18px;
  background:
    linear-gradient(0deg, rgba(0,0,0,0.06), rgba(0,0,0,0.06)) padding-box,
    repeating-linear-gradient(90deg, #f7f0e6 0 10px, #efe6d9 10px 20px) border-box;
  border:1px solid rgba(0,0,0,0.08);
  border-radius:3px;
  transform:rotate(-5deg);
  box-shadow:0 2px 6px rgba(0,0,0,0.12);
  opacity:0.95;
}

.wrap{
  position:relative;
  width:100%;
  max-width:var(--hero-max);
  background:
    linear-gradient(var(--paper), var(--paper)),
    url("https://www.transparenttextures.com/patterns/paper-1.png");
  border:1px solid var(--border);
  border-radius:14px;
  padding:32px 26px 28px;
  box-shadow:0 10px 24px rgba(0,0,0,0.15), 0 2px 0 rgba(0,0,0,0.04);
  overflow:hidden;
  margin-inline:auto;
}

/* Header row on index */
.header{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:8px;
  flex-wrap:wrap;
}
.header .logo{
  width:68px; height:68px; border-width:2px;
}

/* Buttons */
.btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  background:var(--accent);
  color:var(--accent-contrast);
  border:1px solid var(--accent);
  padding:12px 16px;
  border-radius:12px;
  cursor:pointer;
  font-weight:700;
  font-family:var(--font-body);
  text-decoration:none;
  transition:background .2s ease, color .2s ease, border-color .2s ease, transform .05s ease;
  user-select:none;
}
.btn:hover{ background:transparent; color:var(--ink); border-color:var(--ink); }
.btn:active{ transform:translateY(1px); }
.btn[disabled]{ opacity:.6; cursor:not-allowed; }

/* Form (index) */
form{ display:grid; gap:16px; }
label{
  display:block;
  font-family:var(--font-accent);
  font-weight:700;
  font-size:20px;
  margin-bottom:6px;
}
input[type="text"],
input[type="email"],
textarea{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--ink);
  outline:none;
  font-family:var(--font-body);
  font-size:16px;
  line-height:1.45;
  transition: box-shadow .15s ease, border-color .15s ease, background-color .15s ease;
}
input::placeholder, textarea::placeholder{ color:#8a8a8a; }
input[type="text"]:focus,
input[type="email"]:focus,
textarea:focus{
  border-color:#bfb8ab;
  box-shadow:0 0 0 3px rgba(17,17,17,.06);
  background:#fff;
}
textarea{ min-height:120px; resize:vertical; }

/* Single column */
.row{ display:grid; gap:14px; grid-template-columns:1fr; }
.row > *{ min-width:0; }

/* Helper text */
.hint{ color:var(--muted); font-size:13px; margin-top:6px; font-family:var(--font-body); }

/* File input group */
.file-group{ display:grid; gap:10px; }
#image{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
}
.file-actions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.file-name{
  max-width:100%;
  padding:8px 10px;
  border-radius:10px;
  border:1px dashed var(--border);
  background:#fff;
  color:var(--muted);
  font-size:14px;
  font-family:var(--font-body);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Footer actions + status */
.actions{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:6px; }
.status{ font-size:14px; color:var(--muted); min-height:20px; font-family:var(--font-body); }
.status.error{ color:#b00020; }

/* Preview block (index) */
.preview{
  display:none;
  margin-top:10px;
  background:#ffffff;
  border:1px solid #e7e1d6;
  border-radius:6px;
  padding:10px 10px 16px; /* extra bottom padding */
  box-shadow:0 10px 18px rgba(0,0,0,.18), 0 2px 0 rgba(0,0,0,.04);
  width:100%;
  transform:rotate(-1.2deg);
  position:relative;
  margin-bottom:14px; /* spacing below preview */
}
.preview::before,
.preview::after{
  content:"";
  position:absolute;
  width:64px; height:16px;
  background:
    linear-gradient(0deg, rgba(0,0,0,0.06), rgba(0,0,0,0.06)) padding-box,
    repeating-linear-gradient(90deg, #f7f0e6 0 10px, #efe6d9 10px 20px) border-box;
  border:1px solid rgba(0,0,0,0.08);
  top:-8px;
  border-radius:3px;
  box-shadow:0 2px 6px rgba(0,0,0,0.12);
  opacity:0.95;
}
.preview::before{ left:14px; transform:rotate(-8deg); }
.preview::after { right:14px; transform:rotate(8deg); }
.preview img{
  display:block;
  width:100%;
  max-height:360px;
  object-fit:contain;
  background:#fff;
  border-radius:4px;
}
.preview .meta{
  margin-top:8px;
  font-size:12px;
  color:#6a6a6a;
  text-align:center;
  transform:rotate(1.2deg);
  font-family:var(--font-body);
}

/* ---------- Thank-you page enhancements (restored) ---------- */

/* Collage background elements (outside the card) */
.collage-bg{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
}
.ripped-paper{
  position:absolute;
  left:0; right:0;
  height:120px;
  background:
    linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,0)) top/100% 40% no-repeat,
    url("https://www.transparenttextures.com/patterns/paper-fibers.png");
  filter:drop-shadow(0 6px 10px rgba(0,0,0,.15));
  mask: radial-gradient(60% 60% at 50% 0%, #000 70%, transparent 72%) top/60px 100% repeat-x;
  opacity:.55;
}
.rp-top{ top:0; transform:rotate(0.2deg); }
.rp-bottom{ bottom:0; transform:rotate(-0.2deg); }

.sticker{
  position:absolute;
  width:90px; height:90px;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.15));
  opacity:.9;
}
.sticker.flower{
  background:
    radial-gradient(circle at 50% 50%, #fff 0 44%, transparent 46%),
    conic-gradient(from 0deg, #f9d8d0, #fbe0a7, #f9f0a7, #dff1c7, #d0e7ff, #f9d8d0);
  -webkit-mask: radial-gradient(circle at 50% 50%, #000 0 44%, transparent 46%),
    radial-gradient(circle at 20% 20%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 80% 20%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 50% 0%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 20% 80%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 80% 80%, #000 0 12%, transparent 13%);
          mask: radial-gradient(circle at 50% 50%, #000 0 44%, transparent 46%),
    radial-gradient(circle at 20% 20%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 80% 20%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 50% 0%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 20% 80%, #000 0 12%, transparent 13%),
    radial-gradient(circle at 80% 80%, #000 0 12%, transparent 13%);
  border-radius:24px;
}
.sticker.star{
  background:
    radial-gradient(circle at 50% 50%, #fff 0 60%, transparent 62%),
    conic-gradient(#fef08a, #fda4af, #93c5fd, #86efac, #fef08a);
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%,
                     50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
  border-radius:8px;
}
.f1{ top:6%; left:4%; transform:rotate(-10deg); }
.f2{ bottom:6%; right:6%; transform:rotate(8deg); }
.s1{ top:10%; right:10%; transform:rotate(12deg); width:70px; height:70px; }
.s2{ bottom:12%; left:10%; transform:rotate(-12deg); width:60px; height:60px; }

/* Hero wrap tweaks */
.wrap--hero{
  text-align:center;
  z-index:1; /* above collage-bg */
}

/* Extra "tapes" on the card */
.tape{
  position:absolute;
  width:110px; height:24px;
  background:
    linear-gradient(0deg, rgba(0,0,0,.06), rgba(0,0,0,.06)) padding-box,
    repeating-linear-gradient(90deg, #f7f0e6 0 10px, #efe6d9 10px 20px) border-box;
  border:1px solid rgba(0,0,0,.08);
  border-radius:4px;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  opacity:.95;
}
.tl{ top:14px; left:24px; transform:rotate(-9deg); }
.tr{ top:14px; right:24px; transform:rotate(9deg); }

/* Hero logo size */
.logo--hero{ width:160px; height:160px; border-width:3px; margin:2px auto 12px; }

/* Lead text */
.lead{
  margin:6px 0 14px;
  color:var(--muted);
  font-size:16px;
}

/* Pills row */
.accent-row{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin:6px 0 10px;
}
.pill{
  background:#fff;
  border:1px solid var(--border);
  border-radius:999px;
  padding:8px 12px;
  font-weight:700;
  font-family:var(--font-body);
  box-shadow:0 2px 8px rgba(0,0,0,.06);
}

/* Polaroid notes */
.notes{
  display:grid;
  grid-template-columns: repeat(3, minmax(140px, 1fr));
  gap:14px;
  margin-top:10px;
}
.polaroid{
  position:relative;
  background:#fff;
  border:1px solid #e7e1d6;
  border-radius:6px;
  padding:10px 10px 16px;
  box-shadow:0 10px 18px rgba(0,0,0,.18), 0 2px 0 rgba(0,0,0,.04);
}
.polaroid .frame{
  width:100%; height:120px;
  background:
    linear-gradient(45deg, #eee, #fff 40%, #eee 60%); /* placeholder look */
  border-radius:4px;
}
.polaroid figcaption{
  margin-top:8px;
  font-size:12px;
  color:#6a6a6a;
  text-align:center;
  font-family:var(--font-body);
}
.p1{ transform:rotate(-1.5deg); }
.p2{ transform:rotate(0.8deg); }
.p3{ transform:rotate(-0.6deg); }

/* Circular stamp */
.stamp{
  position:absolute;
  bottom:14px; right:16px;
  width:96px; height:96px;
  border-radius:50%;
  border:2px dashed #858585;
  color:#858585;
  display:grid;
  place-items:center;
  transform:rotate(-8deg);
  opacity:.9;
  background: radial-gradient(circle at 50% 50%, rgba(0,0,0,.02), transparent 60%);
}
.stamp span{
  font-weight:800;
  letter-spacing:1px;
}
.stamp small{ font-size:10px; }

/* Soft confetti overlay */
@keyframes confettiFloat {
  0% { transform:translateY(0) rotate(0deg); opacity:.8; }
  100%{ transform:translateY(-30px) rotate(15deg); opacity:.3; }
}
.confetti{
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 10% 80%, rgba(255,182,193,.6) 0 4px, transparent 5px),
    radial-gradient(circle at 20% 30%, rgba(255,228,181,.6) 0 4px, transparent 5px),
    radial-gradient(circle at 70% 60%, rgba(173,216,230,.6) 0 4px, transparent 5px),
    radial-gradient(circle at 85% 25%, rgba(144,238,144,.6) 0 4px, transparent 5px),
    radial-gradient(circle at 40% 75%, rgba(255,255,204,.6) 0 4px, transparent 5px);
  animation: confettiFloat 3.5s ease-in-out infinite alternate;
  mix-blend-mode:multiply;
}

/* Thanks page text tweaks */
.wrap p{ margin:0 0 12px; color:var(--muted); font-size:16px; }

/* Responsive tweaks */
@media (max-width: 900px){
  .card{ max-width: min(var(--form-max), 94vw); }
  .wrap{ max-width: 94vw; }
}
@media (max-width: 720px){
  .notes{ grid-template-columns:1fr 1fr; }
  .stamp{ width:84px; height:84px; }
}
@media (max-width: 480px){
  .notes{ grid-template-columns:1fr; }
  .logo--hero{ width:140px; height:140px; }
}
  </style>
</head>
<body class="page-index">
  <!-- Paper-styled card formatted by the inlined CSS -->
  <div class="card" role="form" aria-label="Design submission form">
    <div class="header">
      <img class="logo" src="./tfac.png" alt="TFAC logo" />
      <h1>Tees For A Cause : Design Competition</h1>
    </div>

    <p class="hint" style="margin: 0 0 8px 0;">Upload your Tâ€‘shirt design and stand a chance to win!</p>

    <form id="submissionForm" novalidate>
      <div class="row">
        <div>
          <label for="name">Name</label>
          <input id="name" name="name" type="text" placeholder="Your full name" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />
        </div>
      </div>

      <!-- Age -->
      <div class="row">
        <div>
          <label for="age">Age</label>
          <input id="age" name="age" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 16" required />
          <div class="hint">Enter a number between 5 and 120.</div>
        </div>
      </div>

      <!-- School -->
      <div class="row">
        <div>
          <label for="school">School</label>
          <input id="school" name="school" type="text" placeholder="Your school name" required />
        </div>
      </div>

      <!-- Why interested -->
      <div class="row">
        <div>
          <label for="interest">Why are you interested in participating?</label>
          <textarea id="interest" name="interest" placeholder="Tell us what motivated you to joinâ€¦"></textarea>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="details">Design Details (max 100 words)</label>
          <textarea id="details" name="details" placeholder="Describe your design concept..."></textarea>
          <div class="hint"><span id="detailsCount">0</span>/100 words</div>
        </div>
      </div>

      <div class="row">
        <div class="file-group">
          <label for="image">Upload Design</label>
          <input id="image" name="image" type="file" accept="image/jpeg,image/png,image/webp" />
          <div class="file-actions">
            <button id="pickFileBtn" class="btn" type="button" aria-controls="image">Choose image</button>
            <div id="fileName" class="file-name" aria-live="polite">No file chosen</div>
          </div>

          <div class="hint">Max 25MB. JPG, PNG, or WebP.</div>

          <div id="preview" class="preview" aria-live="polite">
            <img id="previewImg" alt="Selected image preview" />
            <div id="previewMeta" class="meta"></div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn" type="submit">Submit entry</button>
        <div id="status" class="status" role="status" aria-live="polite"></div>
      </div>
    </form>
  </div>

  <div id="thanks" class="wrap" role="status" aria-live="polite" hidden>
    <img class="logo" src="./tfac.png" alt="TFAC logo" />
    <h1 style="margin: 8px 0 8px 0;">Submission received!</h1>
    <p class="hint" style="margin: 0;">Thank you for participating. Weâ€™ll be in touch soon.</p>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Supabase Config (public anon key only â€” you already provided this)
    const SUPABASE_URL = "https://gmgynepoxilolfabbmwc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtZ3luZXBveGlsb2xmYWJibXdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2OTI3NTUsImV4cCI6MjA3NjI2ODc1NX0.wP87opUoux8v2aKhTwfrhMgVPTQxBALGLY6nyl_nTHs";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Target table (public.submissions)
    const TABLE = "submissions"; // schema: public
    const BUCKET = "tfac-uploads";

    const MAX_FILE_BYTES = 25 * 1024 * 1024;
    const ALLOWED_TYPES = ["image/jpeg", "image/png", "image/webp"];
    const MAX_WORDS = 100;

    const form = document.getElementById("submissionForm");
    const submitBtn = document.getElementById("submitBtn");
    const statusEl = document.getElementById("status");

    const imageInput = document.getElementById("image");
    const pickFileBtn = document.getElementById("pickFileBtn");
    const fileNameEl = document.getElementById("fileName");
    const preview = document.getElementById("preview");
    const previewImg = document.getElementById("previewImg");
    const previewMeta = document.getElementById("previewMeta");

    const detailsEl = document.getElementById("details");
    const detailsCountEl = document.getElementById("detailsCount");

    const thanks = document.getElementById("thanks");
    const card = document.querySelector(".card");

    // Track measured image dimensions so we can store them too
    let measuredWidth = null;
    let measuredHeight = null;

    // Helper: word count
    const wordCount = (str) => {
      const tokens = str.trim().split(/\s+/).filter(Boolean);
      return tokens.length === 1 && tokens[0] === "" ? 0 : tokens.length;
    };

    // Live word limit enforcement for details (100 words)
    detailsEl.addEventListener("input", () => {
      const tokens = detailsEl.value.trim().split(/\s+/).filter(Boolean);
      if (tokens.length > MAX_WORDS) {
        detailsEl.value = tokens.slice(0, MAX_WORDS).join(" ");
      }
      detailsCountEl.textContent = wordCount(detailsEl.value);
    });

    // Custom button triggers native file picker
    pickFileBtn.addEventListener("click", () => imageInput.click());

    // Update filename, validate, and show preview
    imageInput.addEventListener("change", () => {
      const file = imageInput.files?.[0];
      if (!file) {
        fileNameEl.textContent = "No file chosen";
        preview.style.display = "none";
        previewImg.removeAttribute("src");
        previewMeta.textContent = "";
        measuredWidth = measuredHeight = null;
        return;
      }

      fileNameEl.textContent = file.name;

      if (!ALLOWED_TYPES.includes(file.type)) {
        setError("Unsupported file type. Only JPG, PNG, or WebP are allowed.");
        imageInput.value = "";
        preview.style.display = "none";
        return;
      }
      if (file.size > MAX_FILE_BYTES) {
        setError("File is too large (max 25MB).");
        imageInput.value = "";
        preview.style.display = "none";
        return;
      }

      const url = URL.createObjectURL(file);
      previewImg.onload = () => {
        const { naturalWidth: w, naturalHeight: h } = previewImg;
        measuredWidth = w;
        measuredHeight = h;
        previewMeta.textContent = `${file.name} â€¢ ${(file.size / 1024 / 1024).toFixed(2)} MB â€¢ ${file.type} â€¢ ${w}Ã—${h}px`;
        URL.revokeObjectURL(url);
      };
      previewImg.onerror = () => {
        measuredWidth = measuredHeight = null;
        previewMeta.textContent = "Could not load preview.";
        URL.revokeObjectURL(url);
      };
      previewImg.src = url;
      preview.style.display = "block";
      clearStatus();
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearStatus();

      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const ageRaw = form.age.value.trim();
      const school = form.school.value.trim();
      const interest = form.interest.value.trim();
      const details = form.details.value.trim();
      const file = imageInput.files?.[0];

      // Validation
      if (!name) return setError("Please enter your name.");
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return setError("Please enter a valid email.");
      if (!ageRaw || isNaN(Number(ageRaw)) || Number(ageRaw) < 5 || Number(ageRaw) > 120) return setError("Please enter a valid age (5â€“120).");
      if (!school) return setError("Please enter your school.");
      if (!file) return setError("Please choose an image.");
      if (!ALLOWED_TYPES.includes(file.type)) return setError("Unsupported file type.");
      if (file.size > MAX_FILE_BYTES) return setError("File is too large (max 25MB).");
      if (wordCount(details) > MAX_WORDS) return setError("Please limit your design description to 100 words.");

      submitBtn.disabled = true;
      setStatus("Uploading your submissionâ€¦");

      try {
        // 1) Upload image to Storage
        const sanitized = file.name.replace(/[^a-zA-Z0-9.\-_ ]/g, "_").replace(/\s+/g, "-").toLowerCase();
        const filePath = `submissions/${Date.now()}_${sanitized}`;

        const { error: uploadError } = await supabase.storage
          .from(BUCKET)
          .upload(filePath, file);

        if (uploadError) throw uploadError;

        // 2) Get public URL
        const { data: publicUrlData, error: urlErr } = supabase.storage
          .from(BUCKET)
          .getPublicUrl(filePath);
        if (urlErr) throw urlErr;
        const imageUrl = publicUrlData.publicUrl;

        // 3) Build full payload with ALL inputs (and useful image metadata)
        const payload = {
          name,
          email,
          age: Number(ageRaw),
          school,
          interest,                // WHY theyâ€™re participating
          details,                 // design description (<=100 words)
          image_url: imageUrl,     // public URL to the uploaded image
          image_original_name: file.name,
          image_sanitized_name: sanitized,
          image_mime: file.type,
          image_size_bytes: file.size,
          image_width: measuredWidth,   // may be null if preview failed
          image_height: measuredHeight, // may be null if preview failed
          submitted_at: new Date().toISOString(),
        };

        // 4) Insert row with all fields into public.submissions
        const { data: inserted, error: insertError } = await supabase
          .from(TABLE) // public.submissions
          .insert([payload])
          .select('id')
          .single();

        if (insertError) throw insertError;

        // optional: get generated id returned
        const submissionId = inserted?.id ?? null;
        console.log('Inserted submission ID:', submissionId);

        setStatus("Submission successful!");
        // Show styled thank-you card
        card.hidden = true;
        thanks.hidden = false;
        window.scrollTo({ top: 0, behavior: "smooth" });
      } catch (err) {
        console.error(err);
        setError(err?.message || "Something went wrong. Please try again.");
      } finally {
        submitBtn.disabled = false;
      }
    });

    function setStatus(msg) {
      statusEl.textContent = msg;
      statusEl.classList.remove("error");
    }
    function setError(msg) {
      statusEl.textContent = msg;
      statusEl.classList.add("error");
    }
    function clearStatus() {
      statusEl.textContent = "";
      statusEl.classList.remove("error");
    }
  </script>
</body>
</html>