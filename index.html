<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>The Fabric Within Us â€” Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Playpen+Sans+Thai&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      padding:24px;
      background:#F5EEDF;
      font-family:"Playpen Sans Thai", system-ui;
    }

    .card{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:36px;
      border-radius:18px;
      box-shadow:0 12px 28px rgba(0,0,0,.18);
    }

    h1{
      font-family:"Bagel Fat One";
      margin:0;
      font-size:36px;
    }

    .subhead{
      margin-top:6px;
      font-size:18px;
      font-weight:600;
    }

    label{
      display:block;
      margin-top:20px;
      font-weight:700;
      font-size:16px;
    }

    input, select{
      width:100%;
      padding:14px 16px;
      border-radius:12px;
      border:1px solid #ccc;
      margin-top:8px;
      font-family:"Playpen Sans Thai", system-ui;
      font-size:15px;
      box-sizing:border-box;
    }

    .qr-box{
      margin:22px auto 12px;
      width:360px;
      padding:22px;
      border-radius:22px;
      border:2px solid #000;
      text-align:center;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
    }

    .qr-box img{
      width:100%;
      border-radius:16px;
    }

    input[type="file"]{ display:none; }

    .file-btn{
      display:inline-block;
      margin-top:10px;
      padding:14px 22px;
      border-radius:14px;
      background:#000;
      color:#fff;
      cursor:pointer;
      font-weight:700;
      font-size:16px;
    }

    .file-name{
      margin-top:8px;
      font-size:14px;
      color:#555;
    }

    .preview{
      display:none;
      margin-top:14px;
      max-width:260px;
      border-radius:14px;
      border:1px solid #ccc;
      box-shadow:0 6px 14px rgba(0,0,0,.15);
    }

    .btn{
      margin-top:30px;
      width:100%;
      padding:18px;
      background:#000;
      color:#fff;
      border:none;
      border-radius:18px;
      font-size:18px;
      font-weight:700;
      cursor:pointer;
      font-family:"Playpen Sans Thai", system-ui;
    }

    .status{ margin-top:16px; font-size:14px; }
    .error{ color:#b00020; }
    .ok{ color:green; }
  </style>
</head>
<body>

<div class="card">

  <div style="display:flex;align-items:center;gap:16px;">
    <img src="./tfac.png" style="width:70px;height:70px;border-radius:50%">
    <div>
      <h1>The Fabric Within Us</h1>
      <div class="subhead">T-Shirt Painting Workshop</div>
    </div>
  </div>

  <form id="form" novalidate>

    <label>Name</label>
    <input name="name" required>

    <label>Email</label>
    <input name="email" type="email" required>

    <label>Age</label>
    <input name="age" inputmode="numeric" required>

    <label>T-Shirt Size</label>
    <select name="size" required>
      <option value="">Select size</option>
      <option>XS</option>
      <option>S</option>
      <option>M</option>
      <option>L</option>
      <option>XL</option>
    </select>

    <label>Phone Number</label>
    <input name="phone" inputmode="numeric" required>

    <label>Scan QR Code to Pay</label>
    <div class="qr-box">
      <img src="./qr.jpg" alt="Payment QR Code">
    </div>

    <label>Upload payment confirmation screenshot (required)</label>

    <label class="file-btn">
      Choose file
      <input type="file" name="image" accept="image/*" required>
    </label>

    <div id="fileName" class="file-name"></div>
    <img id="preview" class="preview">

    <button class="btn">Submit Registration</button>
    <div id="status" class="status"></div>

  </form>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://btjetspsolaoeqvoywqe.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0amV0c3Bzb2xhb2Vxdm95d3FlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NTA2MjAsImV4cCI6MjA4MTUyNjYyMH0.14z4K4CCxUBE-hLwtlB6gx1NgVXDCh1TKZFWfhORd44"
);

const form = document.getElementById("form");
const statusEl = document.getElementById("status");
const preview = document.getElementById("preview");
const fileNameEl = document.getElementById("fileName");

form.image.addEventListener("change", () => {
  const file = form.image.files[0];
  if (!file) return;

  fileNameEl.textContent = file.name;

  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display = "block";
  };
  reader.readAsDataURL(file);
});

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  statusEl.textContent = "";
  statusEl.className = "status";

  const file = form.image.files[0];
  if (!file) {
    statusEl.textContent = "Payment screenshot is required.";
    statusEl.classList.add("error");
    return;
  }

  if (file.size > 600000) {
    statusEl.textContent = "Image too large. Upload under 600 KB.";
    statusEl.classList.add("error");
    return;
  }

  const reader = new FileReader();
  reader.onload = async () => {
    const dataUrl = reader.result;
    const base64 = dataUrl.split(",")[1];

    const { error } = await supabase.from("submissions").insert({
      name: form.name.value.trim(),
      email: form.email.value.trim(),
      age: Number(form.age.value),
      tshirt_size: form.size.value,
      phone: Number(form.phone.value),
      payment_image_base64: base64,
      payment_image_type: file.type,
      payment_image_url: dataUrl
    });

    if (error) {
      statusEl.textContent = error.message;
      statusEl.classList.add("error");
      return;
    }

    statusEl.textContent = "Registration submitted successfully!";
    statusEl.classList.add("ok");
    form.reset();
    preview.style.display = "none";
    fileNameEl.textContent = "";
  };

  reader.readAsDataURL(file);
});
</script>

</body>
</html>
