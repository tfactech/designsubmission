<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TEESFORACAUSE — The Fabric Within Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Playpen+Sans+Thai&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      padding:24px;
      background:#F5EEDF;
      font-family:"Playpen Sans Thai", system-ui;
    }

    .card{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:32px;
      border-radius:16px;
      box-shadow:0 12px 28px rgba(0,0,0,.18);
    }

    h1{
      font-family:"Bagel Fat One";
      margin:0;
      font-size:36px;
    }

    .subhead{
      margin-top:6px;
      font-size:18px;
      color:#000;
      font-weight:600;
    }

    label{
      font-weight:700;
      display:block;
      margin-top:18px;
      font-size:16px;
    }

    input, select{
      width:100%;
      padding:14px 16px;
      border-radius:12px;
      border:1px solid #ccc;
      margin-top:8px;
      font-family:"Playpen Sans Thai", system-ui;
      font-size:15px;
    }

    .qr-box{
      margin:20px auto 10px;
      width:360px;
      padding:22px;
      border-radius:22px;
      background:#fff;
      border:2px solid #000;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
      text-align:center;
    }

    .qr-box img{
      width:100%;
      border-radius:16px;
    }

    .file-btn{
      display:inline-block;
      padding:14px 22px;
      border-radius:14px;
      background:#000;
      color:#fff;
      cursor:pointer;
      font-weight:700;
      font-size:16px;
      font-family:"Playpen Sans Thai", system-ui;
      margin-top:10px;
    }

    input[type="file"]{
      display:none;
    }

    img.preview{
      display:none;
      max-width:300px;
      margin-top:16px;
      border-radius:16px;
      border:1px solid #ccc;
      box-shadow:0 6px 14px rgba(0,0,0,.15);
    }

    .btn{
      display:block;
      width:100%;
      margin-top:30px;
      padding:18px 22px;
      border-radius:18px;
      background:#000;
      color:#fff;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:18px;
      font-family:"Playpen Sans Thai", system-ui;
    }

    .status{ margin-top:14px; }
    .error{ color:#b00020; }
    .ok{ color:green; }

    /* THANK YOU PAGE */
    .thanks-logo{
      width:90px;
      height:90px;
      border-radius:50%;
      margin-bottom:20px;
    }

    .thanks-title{
      font-family:"Bagel Fat One";
      font-size:52px;
      margin-bottom:12px;
    }

    .thanks-text{
      font-size:20px;
    }
  </style>
</head>
<body>

<div id="formCard" class="card">

  <div style="display:flex;align-items:center;gap:16px;">
    <img src="./tfac.png" style="width:70px;height:70px;border-radius:50%">
    <div>
      <h1>TEESFORACAUSE</h1>
      <div class="subhead">The Fabric Within Us — T-Shirt Painting Workshop</div>
    </div>
  </div>

  <form id="submissionForm" novalidate>

    <label>Name</label>
    <input name="name" required>

    <label>Email</label>
    <input name="email" type="email" required>

    <label>Age</label>
    <input name="age" inputmode="numeric" required>

    <label>T-Shirt Size</label>
    <select name="size" required>
      <option value="">Select</option>
      <option>S</option>
      <option>M</option>
      <option>L</option>
      <option>XL</option>
      <option>XXL</option>
    </select>

    <label>Phone Number</label>
    <input name="phone" inputmode="numeric" placeholder="10 digits" required>

    <label>Scan QR Code to Pay</label>
    <div class="qr-box">
      <img src="./qr.jpg" alt="Payment QR Code">
    </div>

    <label>Upload a screenshot of the payment confirmation</label>
    <label class="file-btn">
      Choose file
      <input type="file" name="screenshot" accept="image/*" required>
    </label>

    <img id="preview" class="preview">

    <button class="btn">Submit</button>
    <div id="status" class="status"></div>

  </form>
</div>

<!-- THANK YOU PAGE -->
<div id="thanks" class="card" style="display:none;text-align:center">

  <img src="./tfac.png" alt="TFAC Logo" class="thanks-logo">

  <div class="thanks-title">Thank you for participating!</div>
  <div class="thanks-text">Can't wait to see you there</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient(
  "https://btjetspsolaoeqvoywqe.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0amV0c3Bzb2xhb2Vxdm95d3FlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NTA2MjAsImV4cCI6MjA4MTUyNjYyMH0.14z4K4CCxUBE-hLwtlB6gx1NgVXDCh1TKZFWfhORd44"
);

const form = document.getElementById("submissionForm");
const statusEl = document.getElementById("status");
const preview = document.getElementById("preview");

form.screenshot.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  }
});

form.addEventListener("submit", async e=>{
  e.preventDefault();
  statusEl.textContent = "";

  const f = form;
  const file = f.screenshot.files[0];
  if(!file) return statusEl.textContent = "Upload payment screenshot";

  const path = `${crypto.randomUUID()}-${file.name}`;

  await supabase.storage.from("payments").upload(path, file);

  const { data } = supabase.storage.from("payments").getPublicUrl(path);

  await supabase.from("submissions").insert({
    name: f.name.value.trim(),
    email: f.email.value.trim(),
    age: Number(f.age.value),
    tshirt_size: f.size.value,
    phone: Number(f.phone.value),
    payment_image_url: data.publicUrl
  });

  document.getElementById("formCard").style.display = "none";
  document.getElementById("thanks").style.display = "block";
});
</script>

</body>
</html>
